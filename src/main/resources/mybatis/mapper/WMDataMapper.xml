<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.gdiot.mapper.WMDataMapper">

    <sql id="Base_Column_Sql">
		id,dev_id,orig_value,time,source,
		wm_num,wm_time,data_flag1,data_flag2,data_seq,
		wm_flow,wm_reverse_flow,wm_flow_rate,wm_statu1,wm_statu2,send_ip,send_port
	</sql>

    <insert id="insertOne">
        insert into wm_data (
        <include refid="Base_Column_Sql"></include>
        ) values (default,#{devId,jdbcType=VARCHAR},#{origValue,jdbcType=VARCHAR},#{time,jdbcType=BIGINT},
        #{source,jdbcType=VARCHAR},
        #{wmNum,jdbcType=VARCHAR},#{wmTime,jdbcType=VARCHAR},#{dataFlag1,jdbcType=VARCHAR},
        #{dataFlag2,jdbcType=VARCHAR},#{dataSeq,jdbcType=VARCHAR},
        #{wmFlow,jdbcType=VARCHAR},#{wmReverseFlow,jdbcType=VARCHAR},#{wmFlowRate,jdbcType=VARCHAR},
        #{wmStatu1,jdbcType=VARCHAR},#{wmStatu2,jdbcType=VARCHAR},#{sendIp,jdbcType=VARCHAR},#{sendPort,jdbcType=VARCHAR})
    </insert>

    <select id="selectbyNum" resultType="com.gdiot.model.WMDataPo">
        select * from wm_data
        where 1 = 1
        <if test="wm_num != null">
            and wm_num = #{wm_num,jdbcType=VARCHAR}
        </if>
        order by id desc limit 10
    </select>

    <select id="selectbyDevId" resultType="com.gdiot.model.WMDataPo">
        select * from wm_data
        where 1 = 1
        <if test="dev_id != null">
            and (dev_id = #{dev_id,jdbcType=VARCHAR} or wm_num = #{dev_id,jdbcType=VARCHAR})
        </if>
        order by id desc
        limit #{offset} ,#{limit}
    </select>
    <select id="countbyDevId" resultType="java.lang.Integer">
        select count(*) from wm_data
        where 1 = 1
        <if test="dev_id != null">
            and dev_id = #{dev_id,jdbcType=VARCHAR}
        </if>
        order by id desc
    </select>

    <insert id="insertCmdSendData">
		insert into wm_cmd_send_data (
			id,wm_num,cmd_data,down_status,type
		) values (default,#{wmNum,jdbcType=VARCHAR},#{cmdData,jdbcType=VARCHAR},#{downStatus,jdbcType=VARCHAR},
		#{type,jdbcType=VARCHAR} )
	</insert>

    <select id="selectCmdSendData" resultType="com.gdiot.model.WMCmdDataPo">
		select * from wm_cmd_send_data where down_status = '1' order by id desc
	</select>

    <update id="updateCmdSendStatus">
		UPDATE wm_cmd_send_data 
			SET
			down_status = #{downStatus,jdbcType=VARCHAR},
			update_time = NOW()
			WHERE
			id = #{id} 
	</update>

    <insert id="insertCmdSendLog">
		insert into wm_cmd_send_log (
			id,wm_num,cmd_data,down_ip,down_port,type
		) values (default,#{wmNum,jdbcType=VARCHAR},#{cmdData,jdbcType=VARCHAR},#{downIp,jdbcType=VARCHAR},
		#{downPort,jdbcType=VARCHAR},#{type,jdbcType=VARCHAR})
	</insert>

    <insert id="insertReadData">
		insert into wm_read_data (
			id,wm_num,orig_value,type,source,value,time
		) values (default,#{wmNum,jdbcType=VARCHAR},#{origValue,jdbcType=VARCHAR},#{type,jdbcType=VARCHAR},
		#{source,jdbcType=VARCHAR},#{value,jdbcType=VARCHAR},#{time,jdbcType=BIGINT})
	</insert>

    <select id="selectReadData" resultType="com.gdiot.model.WMReadDataPo">
        select * from wm_read_data
        where 1 = 1
        <if test="wm_num != null">
            and wm_num = #{wm_num,jdbcType=VARCHAR}
        </if>
        <if test="type != null">
            and type = #{type,jdbcType=VARCHAR}
        </if>
        order by id desc
    </select>

</mapper>